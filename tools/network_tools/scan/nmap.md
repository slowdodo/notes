# NMap(Network Mapper)란?

* 모든 운영체제에서 사용가능하다
* 운영체제의 종류 및 사용 서비스에 대한 정보를 파악 가능
* FTP 서버의 취약점을 이용한 bounce 공격을 수행 가능
* NMap은 오픈소스로 누구나 소스를 맞춤형으로 변형도 가능하다.
* 윈도우는 gui로도 사용이 가능하다

# 기본 명령어

* Scan Type
    -sS : TCP SYN(Half-Open)Scan
    -sT : TCP Connect(Open)Scan
    -sU : UDP Scan
    -sF : TCP FIN Scan: FIN 패킷을 이용한 스캔
    -sX : TCP Xmas Scan: FIN, PSH, URG 패킷을 이용한 스캔
    -sN : TCP NULL Scan: NULL 패킷을 이용한 스캔
    -sA : TCP ACK Scan
    -sP : Ping(icmp/icmp echo): Ping을 이용한 호스트 활성화 여부 확인 스캔
    -sD : Decoy 스캔: 실제 스캐너 주소 외에도 다양한 주소로 위조하여 스캔하는 방식
    -b : TCP FTP Bounce Scan, -b <FTP bounce proxy>

* Port Option
    -p 22 : 22번 포트 스캔
    -p <service> : 특정 서비스명(ssh, telnet, http 등)으로 스캔
    -p 20,25,80 : 20, 25, 80번 포트 스캔 -> 여러 포트 스캔
    -p 1-1023 : 1~1023번 포트를 스캔 -> 일정 범위로 포트를 스캔
    -pT:21,23,110,U:53 : TCP 21,23,110번 UDP 53번 포트를 스캔

* Output Option
    -v(verbose) : 상세정보 출력
    -d : Debugging
    -oN <file> : 결과를 일반 파일 형식으로 출력
    -oX <file> : 결과를 XML 파일 형식으로 출력
    -oG <file> : 결과를 Grepable(grep, awk 등으로 분석하기 편하게게 파일 형식으로 출력
    -oA <Directoy>: 일반(.nmap), XML(.xml), Grepable(.gnmap) 파일로 분석


* 기타 Option
    -O : 대상 호스트의 운영체제 정보 출력
    -F : 빠른 네트워크 스캐닝
    -T0~5 : 0(아주 느림) ~ 5(아주 빠름)


# nmap 사용 예

해당 호스트의 정보를 좀 더 자세히 보여줌
```bash
nmap -v 200.200.100.100
```
네트워크 전체를 스캔(포트 확인할때 유용함)
```bash
nmap localhost
```
100~150번 호스트들을 싹 스캔
```bash
nmap 192.168.1.100-150
```
100번과 110번 호스트만을 스캔
```bash
nmap 192.168.1.100, 192.168.100.110
```
해당 호스트의 포트와 운영체제를 스캔
```bash
nmap -O 192.168.1.100
```
Ping을 이용하여 해당 호스트가 살아있는지 검사
```bash
nmap -sP 192.168.1.100
```
1~4000번 포트까지 RPC 포트를 찾아 보여줌
```bash
nmap -sR -p 1-4000
```

# 운영체제의 탐지(OS Fingerprinting)

* 공격대상 시스템에 운영체제에 따라 취약점이 달라서 공격수단의 차이가 생김<br/>
따라서 운영체제의 버전, 종류를 파악하기위해 다양한 형태로 스캐닝 작업을 함

## 운영체제 탐지방법

* TCP 연결설정의 시작 순서번호(ISN(Initial Sequence Number)) 설정 방식은 OS 버전마다 차이가 있다. 어떤 OS는 0부터 시작하고, 1부터 시작, 또는 임의 번호로 시작한다.
* IP 패킷의 수명 시간을 나타내는 TTL(Time To Live)의 기본값도 OS마다 차이가 있으며, IP 패킷의 서비스 유형을 표시하는 ToS(Type of Service) 필드를 구현하는 방식도 차이가 있다.<br/>
이 외에도 구현 방법에 차이가 있는 많은 기능이 있다.
* 배너 그래빙(banner grabbing): 배너(banner)는 텔넷처럼 원격지 시스템에 로그인하면 뜨는 안내문과 비슷한것이다.
    * 이 배너를 확인하면은 OS와 커널의 정보를 파악할수가 있다.
        * 막는 방법은 배너를 수정하는 방법
        * 경고문을 붙여서 사후 행위에 대하여 법적 효력을 부가하는 방법이 있다.
# 목록화(Enumeration)
* 목록화는 풋 프린팅과 스캐닝 작업을 통해서 수집한 정보를 바탕으로 좀 더 실용적인 정보를 얻는 과정
* 풋 프린팅과 스캐닝을 통해 수집된 정보만으로는 공격대상 시스템에 집적적인 피해를 입힐 수 없다. 따라서 풋 프린팅과 스캐닝은 공격 대상의 네트워크 구성이나 실행 중인 서비스 정도만 파악할 수 있다. 그렇기에 실제 공격에 사용할 수 있도록 목록화 해야된다.
* 목록화는 공유 자원 목록화, 사용자 및 그룹 목록화, 응용프로그램 목록화로 구분됨


# 대응책

* 배너 그래빙을 막기위해 배너를 수정
* 불필요한 패킷을 차단하도록 방화벽 설정
* 사용하지 않는 포트는 열어놓지 않음
* 침입탐지시스템(IDS)을 사용해 포트 스캔 탐지
* 시스템 로그 감사
