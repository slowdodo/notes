# 스위치(Switch)란?

* 스위치는 리피터의 기능과 브리지의 기능을 결합한것으로 리피터처럼 신호를 증폭하며 브리지의 내장 회로와 지능을 지님

* 스위치는 개별 컴퓨터 또는 다른 허브 및 스위치를 연결하는 다중 포트(Multiport)장비이다.
* 한 포트에 연결된 장치는 다른 포트에 연결된 장치와 고유한 가상사설 링크를 통하여 통신함
* 특정 포트를 모니터링 하고자 하면 [모니터링 포트(Monitoring Port)](#mornitoring-port--spanswitch-port-analyzer)
<br/> 네트워크 트래픽을 모니터링 할 수 있는 탭(TAP)장비를 통하여 패킷을 복제(Mirroring)해서 트래픽 분석 장비로 전달한다.


# 스위치 종류
* 2계층 스위치(Data link)
    * 모든 포트에 연결된 호스트의 MAC 주소를 학습하며 스위칭 테이블을 생성, 갱신한다.
    * 스위치는 이 테이블을 기초하여 프레임을 전달

* 3계층 스위치(Network)
    * 소프트웨어보다는 하드웨어를 사용한 라우터의 한 형태(때문에 라우팅 스위치라고도 불림)
    * 크로스바(Crossbar) 스위치 와 같은 ASIC 스위칭 기술을 이용하며 OSI 참조모델의 네트워크 계층에서 동작한다.

* 4계층 스위치(Transport)
    * L4 스위치는 포트번호를 기준으로 패킷을 전송하며, 주로 네트워크의 암호화나 애플리케이션 프로토콜에 대한 패킷 필터링에 이용한다.
    * 전송 계층 포트번호를 통해 응용 계층 서비스(HTTP, SMTP, FTP, NFS, Telnet, rlogin)를 구분하고 L4 스위치가 관리하고 있는 서버의 부하에 따라 세그먼트를 적절히 분배한다.


* 7계층 스위치(Application)

    * OSI 참조모델의 세션 계층과 응용 계층의 데이터 영역까지 분석하여 응용 세션의 제어 수행이 가능하다.
    * 일반적으로 l4 스위치가 0~1023번까지의 포트만을 인식하는데 비해 L7 스위치는 그 이외의 포트번호에 대해서도 인식이 가능하다.

# 스위치 방법에 따른 분류

## Store and Forward 방식

* 스위치나 브리지가 일단 들어오는 프레임을 전부 받아들인 다음에 처리를 시작하는 방식
* 에러가 발견되면 브리지나 스위치는 이 프레임을 버리고 재 전송을 요구하기에
*에러 복구능력*이 뛰어나다
## Cut Through 방식
* Store-and-Forward 방식처럼 프레임이 다 들어오기를 기다리지 않고 앞에 들어오는 목적지 주소만을 본 다음에 바로 목적지로 전송하기 떄문에 처음 48bit만을 본다.
* 따라서 이전 방식에 비해서 훨씬 처리를 빨리한다는 장점을 가지고 있지만<br/>
프레임에서 에러를 찾아내기가 어렵기 때문에 에러 복구능력에는 약점을 가진다.

## Fragment Free 방식
* Store_and_Forward 방식과 Cut_Through 방식의 장점을 결합한 방식으로 전체 프레임이 다 들어올 때까지 기다릴 필요가 없다는 측면에서는 Cut_Through와 비슷하지만 처음 48bit만 보는것이 아니라 512bit를 보게된다. 
* 따라서 에러 감지 능력이 Cut_Through에 비해 우수하지만 속도가 느림

# 기능
* Leaning
    * 배움
* Flooding 
    * 목적지를 모르면 들어온 포트를 제외한 다른 모든 포트로 뿌림
* Forwarding
    * 해당 포트로 넘겨줌
* Filtering
    * 다른 포트로는 못 건너가게 막음
* Aging
    * 나이먹음

# Mornitoring Port = SPAN(Switch Port Analyzer)
![SPAN](https://www.garlandtechnology.com/hs-fs/hubfs/Current/Diagrams/Diagrams%202020/TAP-v-SPAN-Diagram-SPAN.png?width=599&height=220&name=TAP-v-SPAN-Diagram-SPAN.png)

SPAN은 네트워크의 상황에따라 가용성이 침해되기에 법적 증거로는 로그를 수집하는것은 적합한 방법이 아니다. 따라서 고가의 장비이며 설치가 까다로운 TAP으로 로그를 수집해야한다.  
하지만 그렇다고 TAP을 사용해서는 효과적인 모니터링이 어려운 경우가 있기에 (비용문제, 시간문제 등으로 NAT, Bridge의 모니터링이 어려운 케이스) 목적에 맞게 SPAN도 활용하는것이 좋은 방법이다.

* 스위치에서 제공해주는 포트로 스위치를 통과하는 모든 패킷의 내용을 복재해서 전달하는 포트를 말한다.
* 네트워크 사용량, 응답 시간 등 장비 성능을 관리할 목적으로 사용
* 공격자가 물리적으로 해당 스위치 장비에 접근할 수 잇다면 모니터링 포트를 자신의 PC와 연결하여 스니핑이 가능

## 특징
* 네트워크 노드 사이에 구성하면 네트워크 장비가 송/수신 패킷을 복사한 후 관리자에게 넘김
* SPAN에서 분석되는 포트는 -> Source Port
* SPAN에서 분석을 수행하는 포트는 -> SPAN Destination Port
* IPS 또는 IDS 장비에 패킷을 전달하는 목적으로 사용
* SPAN Destionation 포트에 연결된 장비는 일반적인 통신이 불가능하다

# Tap equipment
* 네트워크상에서 전송되는 패킷을 중단 없이 모니터링하기 위한 장비
* 네트워크 구간에 직접연결하여 설치된 지점을 통과하는 모든 패킷을 네트워크 흐름에 영향을 주지 않으면서
복제하여 모니터링 할 수 있도록 해준다.

## 특징


# Crossbar 스위치
* 점대점 연결을 최적화하기 위해 설계된 장비
